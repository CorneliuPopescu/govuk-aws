#
# Snippet: puppetmaster
#

echo "[$(date '+%H:%M:%S %d-%m-%Y')] START SNIPPET: puppetmaster"

echo "127.0.0.1 puppet" >> /etc/hosts 

# Enable autosigning of everything
echo '*' > /etc/puppet/autosign.conf

useradd deploy -m -s /bin/bash 
mkdir -p /etc/puppet /usr/share/puppet/production/releases /usr/share/puppet/production/shared/cached-copy
chown -R deploy: /usr/share/puppet/*
apt-get -y install ruby-bundler

# For Puppetdb
apt-get -y install openjdk-7-jre-headless

gem install --no-ri --no-rdoc hiera-eyaml-gpg gpgme

# on the machine run a verify
puppet apply -e 'notify { "Hello from Puppet": }'

echo "[$(date '+%H:%M:%S %d-%m-%Y')] END SNIPPET: puppetmaster"

